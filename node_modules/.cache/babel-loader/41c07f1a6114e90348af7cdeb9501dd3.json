{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/prasa/Desktop/origin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/prasa/Desktop/origin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/prasa/Desktop/origin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import axios from'axios';import React,{useEffect,useState}from'react';import CurrencyFormat from'react-currency-format';import{Link,useHistory}from'react-router-dom';import Checkoutproduct from'./Checkoutproduct';import'./Payment.css';import{getBasketTotal}from'./reducer';import{useStateValue}from'./StateProvider';import{db}from\"./firebase\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',//stripe expects the total in a currencies subunits \nurl:\"/payments/create?total=\".concat(getBasketTotal(basket)*1)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log('the secret',clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{Card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;db.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:'EMPTY_BASKET'});history.replace('/Orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){setDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"}),/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"RIT islampur\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sangli\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payments_items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(Checkoutproduct,{id:item.id,title:item.title,image:item.image,price:item.price});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_pricecontainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total : \",value,\" \"]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"Rs \"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["C:/Users/prasa/Desktop/origin/src/Payment.js"],"names":["CardElement","useElements","useStripe","axios","React","useEffect","useState","CurrencyFormat","Link","useHistory","Checkoutproduct","getBasketTotal","useStateValue","db","Payment","basket","user","dispatch","history","stripe","elements","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","Card","getElement","then","paymentIntent","collection","doc","uid","id","set","amount","created","type","replace","payload","handleChange","empty","message","length","email","map","item","title","image","price","value"],"mappings":"ybAAA,OAASA,WAAT,CAAsBC,WAAtB,CAAmCC,SAAnC,KAAoD,yBAApD,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,cAAP,KAA2B,uBAA3B,CACA,OAASC,IAAT,CAAgBC,UAAhB,KAAkC,kBAAlC,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAO,eAAP,CACA,OAASC,cAAT,KAA+B,WAA/B,CACA,OAASC,aAAT,KAA8B,iBAA9B,CACA,OAAQC,EAAR,KAAiB,YAAjB,C,wFACA,QAASC,CAAAA,OAAT,EAAmB,CACf,mBAAmCF,aAAa,EAAhD,sFAAQG,MAAR,kBAAQA,MAAR,CAAiBC,IAAjB,kBAAiBA,IAAjB,CAAuBC,QAAvB,oBAEA,GAAMC,CAAAA,OAAO,CAAGT,UAAU,EAA1B,CAEA,GAAMU,CAAAA,MAAM,CAAGjB,SAAS,EAAxB,CACA,GAAMkB,CAAAA,QAAQ,CAAGnB,WAAW,EAA5B,CACA,cAAmCK,QAAQ,CAAC,KAAD,CAA3C,wCAAOe,SAAP,eAAmBC,YAAnB,eACA,eAAqChB,QAAQ,CAAC,EAAD,CAA7C,yCAAOiB,UAAP,eAAoBC,aAApB,eAGD,eAA2BlB,QAAQ,CAAC,IAAD,CAAnC,yCAAOmB,KAAP,eAAeC,QAAf,eACA,eAAiCpB,QAAQ,CAAC,IAAD,CAAzC,yCAAOqB,QAAP,eAAkBC,WAAlB,eACA,eAAyCtB,QAAQ,CAAC,IAAD,CAAjD,0CAAOuB,YAAP,gBAAsBC,eAAtB,gBAGAzB,SAAS,CAAC,UAAM,CACf,GAAM0B,CAAAA,eAAe,0FAAG,sKACG5B,CAAAA,KAAK,CAAC,CACzB6B,MAAM,CAAG,MADgB,CAEzB;AACAC,GAAG,kCAA2BtB,cAAc,CAACI,MAAD,CAAd,CAAyB,CAApD,CAHsB,CAAD,CADR,QACdmB,QADc,eAMpBJ,eAAe,CAACI,QAAQ,CAACC,IAAT,CAAcN,YAAf,CAAf,CANoB,sDAAH,kBAAfE,CAAAA,eAAe,0CAArB,CAQAA,eAAe,GAClB,CAVW,CAUT,CAAChB,MAAD,CAVS,CAAT,CAYHqB,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0BR,YAA1B,EAEI,GAAMS,CAAAA,YAAY,2FAAG,kBAAOC,KAAP,kIACjBA,KAAK,CAACC,cAAN,GACAhB,aAAa,CAAC,IAAD,CAAb,CAFiB,uBAIML,CAAAA,MAAM,CAACsB,kBAAP,CAA0BZ,YAA1B,CAAyC,CAC3Da,cAAc,CAAC,CACfC,IAAI,CAAEvB,QAAQ,CAACwB,UAAT,CAAoB5C,WAApB,CADS,CAD4C,CAAzC,EAInB6C,IAJmB,CAId,eAAoB,IAAlBC,CAAAA,aAAkB,OAAlBA,aAAkB,CAEzBjC,EAAE,CAACkC,UAAH,CAAc,OAAd,EACCC,GADD,CACKhC,IADL,SACKA,IADL,iBACKA,IAAI,CAAEiC,GADX,EAECF,UAFD,CAEY,QAFZ,EAGCC,GAHD,CAGKF,aAAa,CAACI,EAHnB,EAICC,GAJD,CAIK,CACDpC,MAAM,CAAEA,MADP,CAEDqC,MAAM,CAAEN,aAAa,CAACM,MAFrB,CAGDC,OAAO,CAAEP,aAAa,CAACO,OAHtB,CAJL,EAUA/B,YAAY,CAAC,IAAD,CAAZ,CACAI,QAAQ,CAAC,IAAD,CAAR,CACAF,aAAa,CAAC,KAAD,CAAb,CACAP,QAAQ,CAAC,CACLqC,IAAI,CAAC,cADA,CAAD,CAAR,CAKApC,OAAO,CAACqC,OAAR,CAAgB,SAAhB,EACF,CAzBqB,CAJN,QAIVC,OAJU,wEAAH,kBAAZlB,CAAAA,YAAY,6CAAlB,CAgCJ,GAAMmB,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAAlB,KAAK,CAAI,CAE1BX,WAAW,CAACW,KAAK,CAACmB,KAAP,CAAX,CACAhC,QAAQ,CAACa,KAAK,CAACd,KAAN,CAAcc,KAAK,CAACd,KAAN,CAAYkC,OAA1B,CAAoC,EAArC,CAAR,CACH,CAJD,CAKI,mBACI,kCACI,aAAK,SAAS,CAAC,mBAAf,wBACI,gDAAc,MAAC,IAAD,EAAM,EAAE,CAAC,WAAT,WAAsB5C,MAAtB,SAAsBA,MAAtB,iBAAsBA,MAAM,CAAE6C,MAA9B,YAAd,OADJ,cAGQ,YAAK,SAAS,CAAC,iBAAf,uBACI,aAAK,SAAS,CAAC,eAAf,wBACI,wCADJ,cAEI,mBAAI5C,IAAJ,SAAIA,IAAJ,iBAAIA,IAAI,CAAE6C,KAAV,EAFJ,cAGI,mCAHJ,cAII,6BAJJ,GADJ,EAHR,cAeI,aAAK,SAAS,CAAC,iBAAf,wBAEY,YAAK,SAAS,CAAC,eAAf,uBACG,iDADH,EAFZ,cAKU,YAAK,SAAS,CAAC,gBAAf,UACK9C,MAAM,CAAC+C,GAAP,CAAW,SAAAC,IAAI,qBACZ,KAAC,eAAD,EAEA,EAAE,CAAEA,IAAI,CAACb,EAFT,CAGA,KAAK,CAAEa,IAAI,CAACC,KAHZ,CAID,KAAK,CAAED,IAAI,CAACE,KAJX,CAKA,KAAK,CAAEF,IAAI,CAACG,KALZ,EADY,EAAf,CADL,EALV,GAfJ,cAoCI,aAAK,SAAS,CAAC,iBAAf,wBACE,YAAK,SAAS,CAAC,eAAf,uBACI,sCADJ,EADF,cAKM,YAAK,SAAS,CAAC,iBAAf,uBAEI,cAAM,QAAQ,CAAE5B,YAAhB,wBACU,KAAC,WAAD,EAAc,QAAQ,CAAEmB,YAAxB,EADV,cAEU,aAAK,SAAS,CAAC,wBAAf,wBACG,KAAE,cAAF,EACE,UAAU,CAAE,oBAACU,KAAD,qBAET,uCAAmBA,KAAnB,OAFS,EADd,CAOE,YAAY,CAAE,CAPhB,CAQE,KAAK,CAAExD,cAAc,CAACI,MAAD,CARvB,CASE,WAAW,CAAE,MATf,CAUE,iBAAiB,CAAI,IAVvB,CAWE,MAAM,CAAI,KAXZ,EADH,cAeG,eAAQ,QAAQ,CAAEQ,UAAU,EAAII,QAAd,EAA0BN,SAA5C,uBACI,sBAAOE,UAAU,cAAG,iCAAH,CAAuB,SAAxC,EADJ,EAfH,GAFV,CAsBWE,KAAK,eAAK,qBAAMA,KAAN,EAtBrB,GAFJ,EALN,GApCJ,GADJ,EADJ,CA0EH,CAED,cAAeX,CAAAA,OAAf","sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport axios from 'axios';\nimport React, { useEffect, useState } from 'react'\nimport CurrencyFormat from 'react-currency-format';\nimport { Link , useHistory } from 'react-router-dom';\nimport Checkoutproduct from './Checkoutproduct';\nimport './Payment.css'\nimport { getBasketTotal } from './reducer';\nimport { useStateValue } from './StateProvider'\nimport {db} from \"./firebase\"\nfunction Payment() {\n    const [{basket , user},dispatch] = useStateValue();\n\n    const history = useHistory();\n\n    const stripe = useStripe();\n    const elements = useElements();\n    const [succeeded , setSucceeded] = useState(false);\n    const [processing , setProcessing] = useState(\"\");\n\n\n   const [error , setError] = useState(null);\n   const [disabled , setDisabled] = useState(true);\n   const [clientSecret , setClientSecret] = useState(true);\n   \n\n   useEffect(() => {\n    const getClientSecret = async () =>{\n        const response = await axios({\n            method : 'post',\n            //stripe expects the total in a currencies subunits \n            url:`/payments/create?total=${getBasketTotal(basket) * 1 }`\n        });\n        setClientSecret(response.data.clientSecret) \n    }\n    getClientSecret();\n}, [basket])\n\nconsole.log('the secret', clientSecret)\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n        setProcessing(true);\n       \n         const payload = await stripe.confirmCardPayment(clientSecret , {\n             payment_method:{\n             Card: elements.getElement(CardElement)\n             }\n         }).then(({paymentIntent}) =>{\n\n            db.collection('users')\n            .doc(user?.uid)\n            .collection('orders')\n            .doc(paymentIntent.id)\n            .set({\n                basket: basket,\n                amount: paymentIntent.amount,\n                created: paymentIntent.created\n            })\n\n            setSucceeded(true);\n            setError(null)\n            setProcessing(false)\n            dispatch({\n                type:'EMPTY_BASKET'\n            })\n\n\n            history.replace('/Orders')\n         })\n\n}\nconst handleChange = event => {\n    \n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n}\n    return (\n        <div>\n            <div className=\"payment_container\">\n                <h1>Checkout (<Link to='/checkout'>{basket?.length} items</Link>)</h1>\n                {/* payment address*/}\n                    <div className=\"payment_section\">\n                        <div className=\"payment_title\">\n                            <h3>Delivery Address</h3>\n                            <p>{user?.email}</p>\n                            <p>RIT islampur</p>\n                            <p>Sangli</p>\n\n                        </div>\n                        \n                    </div>\n\n                {/* review items*/}\n                <div className=\"payment_section\">\n                \n                            <div className=\"payment_title\">\n                               <h3>Review items and delivery</h3>\n                            </div>\n                          <div className=\"payments_items\">\n                              {basket.map(item =>(\n                                  <Checkoutproduct\n                                  \n                                  id={item.id}\n                                  title={item.title}\n                                 image={item.image}\n                                  price={item.price}\n                                 \n                                  />\n                              ))}\n                              </div>  \n                        \n                </div>\n\n                {/* payment method*/}\n                <div className=\"payment_section\">\n                  <div className=\"payment_title\">\n                      <h3>payment Method</h3>\n                      </div>\n\n                      <div className=\"payment_details\">\n                          {/*stripe*/}\n                          <form onSubmit={handleSubmit} >\n                                    <CardElement  onChange={handleChange}/>\n                                    <div className=\"payment_pricecontainer\">\n                                       < CurrencyFormat \n                                         renderText={(value) => (\n\n                                            <h3>Order Total : {value} </h3>\n                                             \n                                         )}\n\n                                         decimalScale={2}\n                                         value={getBasketTotal(basket)}\n                                         displayType={\"text\"}\n                                         thousandSeparator = {true}\n                                         prefix = {\"Rs \"}\n                                       \n                                       />\n                                       <button disabled={processing || disabled || succeeded}>\n                                           <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\n                                       </button>\n                                    </div>\n\n                                    {error &&  <div>{error}</div> }\n                                </form>\n                          </div>      \n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default Payment\n"]},"metadata":{},"sourceType":"module"}